mutate(Taxon = str_replace_all(Taxon, "; s__$", ""),
Taxon = str_replace_all(Taxon, "; g__$", ""),
Taxon = str_replace_all(Taxon, "; f__$", ""),
Taxon = str_replace_all(Taxon, "; o__$", ""),
Taxon = str_replace_all(Taxon, "; c__$", ""),
Taxon = str_replace_all(Taxon, "; p__$", ""),
Taxon = str_replace_all(Taxon, "; k__$", ""),
Taxon = str_replace_all(Taxon, "\\[|\\]", ""),
Taxon = str_replace_all(Taxon, "\\s", "")) %>%
dplyr::filter(!grepl("s__*", Taxon)) %>%
dplyr::filter(grepl("g__*", Taxon)) %>%
select(-Confidence) %>%
mutate(Taxon = str_replace_all(Taxon, "\\w__", "")) %>%
separate(Taxon, into = c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus"), sep = ";") %>%
write_csv("data/qiime2/qiime2_tidy_taxonomy.csv")
# QIIME2 composite
library(tidyverse, suppressPackageStartupMessages())
qiime2_tidy_metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv", show_col_types = FALSE)
qiime2_tidy_otutable <- read_csv("data/qiime2/qiime2_tidy_otutable.csv", show_col_types = FALSE)
qiime2_tidy_taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE)
qiime2_composite <- inner_join(qiime2_tidy_metadata, qiime2_tidy_otutable, by = "sample_id") %>%
inner_join(., qiime2_tidy_taxonomy, by = "feature") %>%
group_by(sample_id) %>%
mutate(rel_abund = count/sum(count)) %>%
ungroup() %>%
mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>%
relocate(count, .before = rel_abund)
write_csv(qiime2_composite, "data/qiime2/qiime2_composite.csv")
library(tidyverse)
library(phyloseq)
library(microbiome)
library(ape)
metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv",show_col_types = FALSE) %>%
tibble::column_to_rownames("sample_id") %>%
sample_data(metadata)
otutable <- read_csv("data/qiime2/qiime2_tidy_features.csv",show_col_types = FALSE) %>%
pivot_wider(id_cols = sample_id, names_from = feature, values_from = count) %>%
tibble::column_to_rownames("sample_id") %>%
otu_table(otutable, taxa_are_rows = FALSE)
taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE) %>%
tibble::column_to_rownames("feature") %>%
as.matrix() %>%
tax_table(taxonomy)
ps_raw_basic <- merge_phyloseq(metadata, otutable, taxonomy)
library(ape)
ps_tree = rtree(ntaxa(ps_raw_basic), rooted=TRUE, tip.label=taxa_names(ps_raw_basic))
ps_raw <- phyloseq::merge_phyloseq(ps_raw_basic, ps_tree)
ps_rel <- phyloseq::transform_sample_counts(ps_raw, function(x){x / sum(x)})
save(ps_tree, ps_raw, ps_rel,  file = "data/qiime2/qiime2_phyloseq_objects.rda")
library(tidyverse)
library(phyloseq)
library(microbiome)
library(ape)
metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv",show_col_types = FALSE) %>%
tibble::column_to_rownames("sample_id") %>%
sample_data(metadata)
otutable <- read_csv("data/qiime2/qiime2_tidy_features.csv",show_col_types = FALSE) %>%
pivot_wider(id_cols = sample_id, names_from = feature, values_from = count) %>%
tibble::column_to_rownames("sample_id") %>%
otu_table(otutable, taxa_are_rows = FALSE)
taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE) %>%
tibble::column_to_rownames("feature") %>%
as.matrix() %>%
tax_table(taxonomy)
ps_raw_basic <- merge_phyloseq(metadata, otutable, taxonomy)
library(ape)
ps_tree = rtree(ntaxa(ps_raw_basic), rooted=TRUE, tip.label=taxa_names(ps_raw_basic))
ps_raw <- phyloseq::merge_phyloseq(ps_raw_basic, ps_tree)
ps_rel <- phyloseq::transform_sample_counts(ps_raw, function(x){x / sum(x)})
save(ps_tree, ps_raw, ps_rel,  file = "data/qiime2/qiime2_phyloseq_objects.rda")
load("~/Dropbox/2024/TMB2024/COMPLETED/imap-data-preparation/data/qiime2/qiime2_phyloseq_objects.rda")
load("~/Dropbox/2024/TMB2024/COMPLETED/imap-data-preparation/data/qiime2/qiime2_phyloseq_objects.rda")
library(tidyverse)
library(phyloseq)
library(microbiome)
library(ape)
metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv",show_col_types = FALSE) %>%
tibble::column_to_rownames("sample_id") %>%
sample_data(metadata)
otutable <- read_csv("data/qiime2/qiime2_tidy_features.csv",show_col_types = FALSE) %>%
pivot_wider(id_cols = sample_id, names_from = feature, values_from = count) %>%
tibble::column_to_rownames("sample_id") %>%
otu_table(otutable, taxa_are_rows = FALSE)
taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE) %>%
tibble::column_to_rownames("feature") %>%
as.matrix() %>%
tax_table(taxonomy)
ps_raw_basic <- merge_phyloseq(metadata, otutable, taxonomy)
library(ape)
ps_tree = rtree(ntaxa(ps_raw_basic), rooted=TRUE, tip.label=taxa_names(ps_raw_basic))
ps_raw <- phyloseq::merge_phyloseq(ps_raw_basic, ps_tree)
ps_rel <- phyloseq::transform_sample_counts(ps_raw, function(x){x / sum(x)})
save(ps_tree, ps_raw, ps_rel,  file = "data/qiime2/qiime2_phyloseq_objects.rda")
library(tidyverse)
library(phyloseq)
library(microbiome)
library(ape)
metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv",show_col_types = FALSE) %>%
tibble::column_to_rownames("sample_id") %>%
sample_data(metadata)
otutable <- read_csv("data/qiime2/qiime2_tidy_features.csv",show_col_types = FALSE) %>%
pivot_wider(id_cols = sample_id, names_from = feature, values_from = count) %>%
tibble::column_to_rownames("sample_id") %>%
otu_table(otutable, taxa_are_rows = FALSE)
taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE) %>%
tibble::column_to_rownames("feature") %>%
as.matrix() %>%
tax_table(taxonomy)
ps_raw_basic <- merge_phyloseq(metadata, otutable, taxonomy)
library(ape)
ps_tree = rtree(ntaxa(ps_raw_basic), rooted=TRUE, tip.label=taxa_names(ps_raw_basic))
ps_raw <- phyloseq::merge_phyloseq(ps_raw_basic, ps_tree)
ps_rel <- phyloseq::transform_sample_counts(ps_raw, function(x){x / sum(x)})
save(ps_tree, ps_raw, ps_rel,  file = "data/qiime2/qiime2_phyloseq_objects.rda")
source("~/Dropbox/2024/TMB2024/COMPLETED/imap-data-preparation/workflow/scripts/mothur_tidy_metadata.R")
library(tidyverse, suppressPackageStartupMessages())
# QIIME2  metadata
read_tsv("../imap-qiime2-bioinformatics/resources/metadata/qiime2_sample_metadata.tsv", show_col_types = FALSE) %>%
rename(sample_id="sample-id") %>%
write_csv("data/qiime2/qiime2_tidy_metadata.csv")
read_tsv("../imap-qiime2-bioinformatics/resources/metadata/qiime2_sample_metadata.tsv", show_col_types = FALSE)
if (!dir.exists('data')) {dir.create('data')}
if (!dir.exists('data/mothur')) {dir.create('data/mothur')}
if (!dir.exists('data/qiime2')) {dir.create('data/qiime2')}
library(tidyverse, suppressPackageStartupMessages())
read_tsv("../imap-qiime2-bioinformatics/resources/metadata/qiime2_sample_metadata.tsv", show_col_types = FALSE) %>%
dplyr::rename(sample_id="sample-id") %>%
write_csv("data/qiime2/qiime2_tidy_metadata.csv")
read_tsv("../imap-qiime2-bioinformatics/qiime2_process/export/feature-table.tsv", skip = 1, show_col_types = FALSE) %>%
dplyr::rename(feature='#OTU ID') %>%
select(-starts_with('Mock')) %>%
mutate_at(2:ncol(.), as.numeric) %>%
mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>%
pivot_longer(-feature, names_to = "sample_id", values_to = "count") %>%
relocate(sample_id, .before = feature) %>%
write_csv("data/qiime2/qiime2_tidy_otutable.csv")
read_tsv("../imap-qiime2-bioinformatics/qiime2_process/export/taxonomy.tsv", show_col_types=FALSE) %>%
dplyr::rename(feature="Feature ID") %>%
distinct() %>%
mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>%
mutate(Taxon = str_replace_all(Taxon, "; s__$", ""),
Taxon = str_replace_all(Taxon, "; g__$", ""),
Taxon = str_replace_all(Taxon, "; f__$", ""),
Taxon = str_replace_all(Taxon, "; o__$", ""),
Taxon = str_replace_all(Taxon, "; c__$", ""),
Taxon = str_replace_all(Taxon, "; p__$", ""),
Taxon = str_replace_all(Taxon, "; k__$", ""),
Taxon = str_replace_all(Taxon, "\\[|\\]", ""),
Taxon = str_replace_all(Taxon, "\\s", "")) %>%
dplyr::filter(!grepl("s__*", Taxon)) %>%
dplyr::filter(grepl("g__*", Taxon)) %>%
select(-Confidence) %>%
mutate(Taxon = str_replace_all(Taxon, "\\w__", "")) %>%
separate(Taxon, into = c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus"), sep = ";") %>%
write_csv("data/qiime2/qiime2_tidy_taxonomy.csv")
# QIIME2 composite
library(tidyverse, suppressPackageStartupMessages())
qiime2_tidy_metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv", show_col_types = FALSE)
qiime2_tidy_otutable <- read_csv("data/qiime2/qiime2_tidy_otutable.csv", show_col_types = FALSE)
qiime2_tidy_taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE)
qiime2_composite <- inner_join(qiime2_tidy_metadata, qiime2_tidy_otutable, by = "sample_id") %>%
inner_join(., qiime2_tidy_taxonomy, by = "feature") %>%
group_by(sample_id) %>%
mutate(rel_abund = count/sum(count)) %>%
ungroup() %>%
mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>%
relocate(count, .before = rel_abund)
write_csv(qiime2_composite, "data/qiime2/qiime2_composite.csv")
library(tidyverse)
library(phyloseq)
library(microbiome)
library(ape)
metadata <- read_csv("data/qiime2/qiime2_tidy_metadata.csv",show_col_types = FALSE) %>%
tibble::column_to_rownames("sample_id") %>%
sample_data(metadata)
otutable <- read_csv("data/qiime2/qiime2_tidy_features.csv",show_col_types = FALSE) %>%
pivot_wider(id_cols = sample_id, names_from = feature, values_from = count) %>%
tibble::column_to_rownames("sample_id") %>%
otu_table(otutable, taxa_are_rows = FALSE)
taxonomy <- read_csv("data/qiime2/qiime2_tidy_taxonomy.csv", show_col_types = FALSE) %>%
tibble::column_to_rownames("feature") %>%
as.matrix() %>%
tax_table(taxonomy)
ps_raw_basic <- merge_phyloseq(metadata, otutable, taxonomy)
library(ape)
ps_tree = rtree(ntaxa(ps_raw_basic), rooted=TRUE, tip.label=taxa_names(ps_raw_basic))
ps_raw <- phyloseq::merge_phyloseq(ps_raw_basic, ps_tree)
ps_rel <- phyloseq::transform_sample_counts(ps_raw, function(x){x / sum(x)})
save(ps_tree, ps_raw, ps_rel,  file = "data/qiime2/qiime2_phyloseq_objects.rda")
qiime2_composite
ps_tree
ps_raw
ps_rel
ps_raw
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature)
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
filter(total != 0) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Bioinfo\nPipeline")
q2
mo
q2
rbind(mo, q2)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature)
q2
mo
q2
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:13))
q2
mo
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:13)) %>%
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
filter(total != 0) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Bioinfo\nPipeline")
q2
mo
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, 3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
mo
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
mo
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
q2
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
filter(total != 0) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Bioinfo\nPipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=10)
ggsave(file="figures/taxon_barplot.svg", width=10, height=10)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
filter(total != 0) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Bioinfo\nPipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=20)
ggsave(file="figures/taxon_barplot.svg", width=10, height=20)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
filter(total != 0) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=20)
ggsave(file="figures/taxon_barplot.svg", width=10, height=20)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 1) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=20)
ggsave(file="figures/taxon_barplot.svg", width=10, height=20)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 10) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=20)
ggsave(file="figures/taxon_barplot.svg", width=10, height=20)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 15) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=15)
ggsave(file="figures/taxon_barplot.svg", width=10, height=15)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 25) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=15)
ggsave(file="figures/taxon_barplot.svg", width=10, height=15)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 30) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=15)
ggsave(file="figures/taxon_barplot.svg", width=10, height=15)
library(tidyverse)
library(svglite)
mo <- read_csv("data/mothur/mothur_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="MOTHUR", .before=2) %>%
select(-otu, -3)
q2 <- read_csv("data/qiime2/qiime2_composite.csv", show_col_types = FALSE) %>%
mutate(pipeline="QIIME2", .before=2) %>%
select(-feature, -c(3:14))
rbind(mo, q2) %>%
group_by(sample_id) %>%
mutate(total = sum(count)) %>%
filter(total > 0) %>%
group_by(Genus) %>%
mutate(total = sum(count)) %>%
# filter(total != 0) %>%
filter(total >= 30) %>%
ungroup() %>%
select(-total) %>%
ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +
facet_grid(~pipeline) +
geom_col() +
coord_flip() +
labs(fill="Pipeline")
ggsave(file="figures/taxon_barplot.png", width=10, height=10)
ggsave(file="figures/taxon_barplot.svg", width=10, height=10)
library(renv)
renv::checkout()
library(BiocManager)
BiocManager::install(phyloseq)
BiocManager::install('phyloseq')
renv::restore()
renv::init()
renv::status()
renv::snapshot()
install.packages("renv")
file.remove("renv.lock")
renv::init()
renv::status()
renv::snapshot()
renv::install('dada2')
renv::snapshot()
renv::snapshot()
